// Generated by CoffeeScript 1.6.3
/* To install this module this module

In app.coffee
	# CurveCurator routes
	curveCuratorRoutes = require './public/src/modules/CurveAnalysis/src/server/routes/CurveCuratorRoutes.js'
	curveCuratorRoutes.setupRoutes(app)
*/


(function() {
  var applicationScripts, requiredScripts;

  exports.setupRoutes = function(app) {
    app.get('/curveCurator/*', exports.curveCuratorIndex);
    return app.get('/api/curves/stub/:exptCode', exports.getCurveStubs);
  };

  requiredScripts = ['/src/lib/jquery.min.js', '/src/lib/json2.js', '/src/lib/underscore.js', '/src/lib/backbone-min.js', '/src/lib/bootstrap/bootstrap.min.js', '/src/lib/bootstrap/bootstrap-tooltip.js', '/src/lib/jqueryFileUpload/js/vendor/jquery.ui.widget.js', '/src/lib/jqueryFileUpload/js/jquery.iframe-transport.js', '/src/lib/bootstrap/bootstrap.min.js', '/src/lib/jquery-ui-1.10.2.custom/js/jquery-ui-1.10.2.custom.min.js'];

  applicationScripts = ['/src/conf/conf.js', '/src/modules/CurveAnalysis/src/client/CurveCurator.js', '/src/modules/CurveAnalysis/src/client/CurveCuratorAppController.js'];

  exports.getCurveStubs = function(req, resp) {
    var baseurl, config, curveCuratorTestData, request,
      _this = this;
    if (global.specRunnerTestmode) {
      console.log(req.params);
      curveCuratorTestData = require('../../../spec/testFixtures/curveCuratorTestFixtures.js');
      return resp.end(JSON.stringify(curveCuratorTestData.curveStubs));
    } else {
      config = require('../../../../../../../conf/compiled/conf.js');
      baseurl = config.all.client.service.rapache.fullpath + "/experimentcode/curvids/?experimentcode=";
      request = require('request');
      return request({
        method: 'GET',
        url: baseurl + req.params.exptCode,
        json: true
      }, function(error, response, json) {
        if (!error && response.statusCode === 200) {
          console.log(JSON.stringify(json));
          return resp.end(JSON.stringify(json));
        } else {
          console.log('got ajax error trying to save new experiment');
          console.log(error);
          console.log(json);
          return console.log(response);
        }
      });
    }
  };

  exports.curveCuratorIndex = function(request, response) {
    var scriptsToLoad;
    global.specRunnerTestmode = false;
    scriptsToLoad = requiredScripts.concat(applicationScripts);
    return response.render('CurveCurator', {
      title: 'Curve Curator',
      scripts: scriptsToLoad,
      appParams: {
        exampleParam: null
      }
    });
  };

}).call(this);
