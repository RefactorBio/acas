Expected Behavior for flag testing files (all for use with ConfirmationRegression.zip):

----------------
| Instructions |
----------------
In order to run tests with these files, you will need to change the
"flaggedWells" variable in your "request" object (or add it) to be
the path from privateUploads to this file.

-----------------------------
| Analysis Group Flag Tests |
-----------------------------

=== Normal use cases without flags ===
uneditedFile.csv
	The most benevolent use case; the user hands us back the override file.
	Should have no errors/warnings, 107 "Hits", no flagged wells, and a
		Z' of -0.607, a Robust Z' of -0.526, a Z of -85.030 and a
		Robust Z of -16.063
		
no file (run "request$flaggedWells <- NULL)
	Should be the same as uneditedFile

=== Altering the structure of the given file ===

missingUserHit.csv
	We have deleted the entire "User Defined Hit" column from the given
		override csv file
	Warning: "The flag file does not appear to contain enough information 
		to modify which trials were hits and which were not. If you only 
		intended to flag individual wells, you may proceed without concern."
	The output should be the same as the uneditedFile.
		
flagHitColumn.csv
	"Hit" column has been changed, instead of "User Defined Hit" column
	Should have no errors/warnings, and overrideDRAFT should have all "yes"
		for the first 30 rows. The statistics should be the same as in
		uneditedFile

deficientFlags.xlsx
	Truncated the flag file to 14 rows of data.
	Error: "There were 14 rows of flag data in the given file, but the 
		experiment has 768 wells. Please download the QC file and edit it 
		again."

=== Flagging analysis groups using atypical cell combinations ===
	
allUserHits.xlsx
	The "User Defined Hit" column is now just a copy of the "Hit" column;
		every cell is filled in.
	Should behave just like uneditedFile.csv
	
oddlyFlaggedGroups.csv
	Some of the entries in the "User Defined Hit" have been shifted down
		a row, so they are no longer at the top of their analysis group.
		Some of the "User Defined Hits" are in a row where the user defined
		hit conflicts with the well hit.
	Should throw no errors or warnings, and work like the uneditedFile.
	
hitsChangedAndMissing.csv
	One of the "yes" groups doesn't have a value entered for user hits, and
		the groups above and below it have been changed to "no"
	Should throw no errors/warnings, have 105 hits, and the same Z's as the
		unedited file.

missingHits.csv
	None of the "User Defined Flag" entries are filled in
	Should be fine; check to make sure that the output file has filled them
		in again.
		
=== Flag capitalization is ignored ===

flagCapitalization.xls
	Flags have different capitalizations, including flags of test wells, of
		control wells, and both "yes" and "no" flags.
	Should throw no warning/error, and have the same output as uneditedFile.

differingCapitalization.xls
	Two flags in the same analysis group differ only by capitalization.
	Should be fine, and have the standard output. Note that the override csv
		you get back will not preserve this capitalization, and in general
		will not preserve capitalization on non-leading entries.

=== Unintelligible Flag Choices ===
		
twoFlags.xlsx
	One of the controls was flagged with "unrecognized flag", in addition to
		"no".
	Error: "There were 2 different entries under 'User Defined Hits' for a 
		single batchName/barcode grouping: no, unrecognized flag. Please enter 
		either 'yes' or 'no'."
	Would also accept an error about an unrecognized flag, or flagging a 
		control, if the order of error checking changed in the future.
		
unrecognizedFlag.xlsx
	One of the "no"s was replaced with "maybe".
	Error: "Unrecognized value in 'User Defined Hits': maybe. Please enter 
		'yes' or 'no'."
					
flagControls.xlsx
	Four controls were flagged: three for CMPD-0137643-1 and one for
		CMPD-0141923-1.
	Error: "Only hits in wells marked as 'test' can be overriden by the user. 
		Please ensure that the 'User Defined Hit' matches the 'Hit' column 
		for non-test wells in the following coroprate batch IDs: 
		CMPD-0137643-1, CMPD-0141923-1"
	Make sure nothing is repeated.

=== Flag both Analysis Groups and Wells ===

flagBothAGandWells.csv
	One well was flagged, which increases the number of hits from 107 to
		109. In addition, one analysis group was changed from ‘no’ to
		‘yes’, which would increase the hit count from 107 to 108
	If you use flaggingStage <- “wellFlags”, you get 109 hits and a warning.
		If you use “analysisGroupFlags”, you get 108 hits and a warning.
		
-------------------------
| Well-level Flag Tests |
-------------------------

=== "Basic" file: just barcode, well, and flag information ===

basicCSV.csv
	We allow users to upload either the override file we gave them, or a
		file of just barcode, well, and flag information. This is the
		second type of file.
	Should have no errors/warnings, and have the same output as
		uneditedFile

basicMissingColumns.xls
	Another 'basic' format, but this time it's missing a 'flag' column
	Error: "An important column appears to be missing from the input. 
		Please ensure that the uploaded file contains columns for
		Well, Barcode, and Flag. If the uploaded file contained calculated 
		results, please ensure that you only modified the columns marked 
		as editable."

basicInfluenceHits.csv
	One point is flagged in a 'basic' format csv
	Should work, and the output has changed: There are 109 hits, Z' is -0.609,
		Robust Z' is -0.529, Z is -85.030, Robust Z is -16.063. Also make sure
		that CMPD-0051259-1 has four "yes" test wells, instead of two.
		
=== Extra Wells Listed ===

duplicateWells.xls
	No flags, but the last barcode/well combination has been entered twice
	Error: "The same barcode and well combination was listed multiple times 
		in the flag file. Please remove duplicates for TEST0002 P24."

unrecognizedWell.xlsx
	One well was added, with a different barcode
	Warning: "Some of the wells listed in the flag file were not found in the 
		experiment data, and will be ignored. Please remove or modify 
		TEST0003 A01."
	The results should be unchanged

flaggedExtras.xlsx
	Two extra wells were added to the file, and both were flagged
	Warning: "Some of the wells listed in the flag file were not found in the 
		experiment data, and will be ignored. Please remove or modify 
		TEST0002 A31, TEST0003 A01."
	The data should be unchanged, and in particular, there should be no
		flagged wells.

basicCapitalization.csv
	This one has inconsistent capitalization, and four flags
	Should have no errors/warnings, and four flags in the summary and
		the output file. Z is -92.038

=== Flagging too many wells ===

allTestsFlagged.csv
	All of the 'test' wells are flagged
	Error: "All of the test wells appear to have been flagged, so there is no 
		data to analyze."
		
oneUnflaggedTest.csv
	Only one test well was left without a flag
	Error: "Only one of the test wells is unflagged, so there is not enough 
	data to analyze."
	
flagAllPC.xlsx
	All the positive controls have been flagged
	Error: "All positive controls appear to have been flagged, so the data 
		cannot be normalized."

onePCUnflagged.xlsx
	Only one positive control is not flagged
	Error: "All of the positive controls in one normalization group (barcode, 
		or barcode and plate row) were flagged, so normalization cannot 
		proceed."

minimumPC.csv
	One positive control from each analysis group is unflagged.
	No warnings or errors. There are 30 flagged wells, 107 hits, and 
		Z' = 0.424 Robust Z' = 0.489, Z = -6.352, Robust Z = -6.390

flagAllNC.csv
	All of the 'NC' wells have been flagged
	Error: "All negative controls appear to have been flagged, so the data 
		cannot be normalized."

oneNCUnflagged.csv
	All but one of the negative controls are flagged
	Error: "All of the negative controls in one normalization group (barcode, 
		or barcode and plate row) were flagged, so normalization cannot 
		proceed."
		
minimumNC.csv
	One negative control for each analysis group is unflagged.
	No warnings or errors. There are 62 flagged wells.
		Z' = -0.476, Robust Z' = -0.509, Z = -85.030, Robust Z: -16.063

=== Providing less flag information ===

oneEmptyFlag.xlsx
	There is only one row in the file, with a blank flag
	Should be fine and have the same results as the unedited file.
		However, currently it errors when trying to replace "" with
		NA (which is unnecessary for an Excel file, anyway.
	
fewFlags.csv
	Only the first nine wells are included in the file
	Should be error/warning free, and have the same data as the unmodified file

=== Use a variety of flag names ===

oddFlagNames.csv
	Five wells have flags: "Flag", "?", "NA", ".\/$#@" and "  space  "
	It should have five flagged wells, 107 hits, Z' of -0.607, Robust Z' of
		-0.526, Z of -98.205, and Robust Z of -15.655.
	This currently errs because it misses the NA. Ideas for fixing:
		only replace "" with NA if there is a "" cell in the frame

oddFlagNames.xls
	The same as above, but in Excel format
	It should have five flagged wells, 107 hits, Z' of -0.607, Robust Z' of
		-0.526, Z of -98.205, and Robust Z of -15.655.
